<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8" />
    <title>UAP授权登录</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="keywords" content="uap" />
    <meta name="description" content="UAP授权登录" />
    <meta name="author" content="dili">
    <link rel="stylesheet" href="/resources/bui/lib/bootstrap-4.4.1-dist/css/bootstrap.min.css" >
    <script src="/resources/bui/lib/jquery/jquery-3.2.1.min.js"></script>
    <script src="/resources/bui/lib/bootstrap-4.4.1-dist/js/bootstrap.bundle.min.js"></script>
    <style>
        /*消除google浏览器黄色框*/
        input:-webkit-autofill,
        input:-webkit-autofill:hover,
        input:-webkit-autofill:focus {
            box-shadow:0 0 0 60px #FFF inset;
            -webkit-text-fill-color: #666;
        }
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            display: inline-block;
            text-align: center;
            vertical-align: middle;
            position: relative;
        }
    </style>
    <script>

    </script>
    <!-- jquery -->
    <link rel="shortcut icon" href="${contextPath}/resources/images/icon/dili-logo.png" />
    <script type="text/javascript" src="${contextPath}/resources/easyui/js/jquery-3.2.1.min.js"></script>
    <link rel="stylesheet" type="text/css" href="${contextPath}/resources/css/login.css">
</head>

<body>
<div class="loginwrap">
    <div class="login">
        <h2 class="login-title"><img src="${contextPath}/resources/images/login-title.png" alt="授权登录"></h2>
        <form id="loginForm" class="login-form" method="post" action="${contextPath}/api/oauth-server/login">
            <table class="userinfo">
                <tbody>
                <tr>
                    <td width="40" class="login-icon login-user-icon">
                    </td>
                    <td>
                        <input id="userName" name="userName" value="" type="text" placeholder="请输入账号" />
                    </td>
                </tr>
                <tr>
                    <td width="40" class="login-icon login-password-icon"></td>
                    <td>
                        <input id="password" name="password" value="" type="password" placeholder="请输入密码" />
                    </td>
                </tr>
                </tbody>
            </table>
            <div style="padding-top: 10px;">
                ${clientName!}将获得以下权限：
                <hr>
                <div style="margin-bottom:20px">
                    <div id="checkbox-group">
                        <div class="custom-control custom-checkbox custom-control-inline">
                            <input type="checkbox" id="basicPrivilege" value="1" style="color:#999" checked="checked" name="clientPrivilege" onclick="return false;" class="custom-control-input" required>
                            <label class="custom-control-label" style="color:#999;" for="basicPrivilege">获得您的昵称、头像、性别等基本信息:</label>
                        </div>
                        <div class="custom-control custom-checkbox custom-control-inline">
                        <input type="checkbox" id="orgPrivilege" value="2" style="color:#999" name="clientPrivilege" class="custom-control-input" >
                        <label class="custom-control-label" style="color:#999;" for="orgPrivilege">获得您的组织结构信息:</label>
                        </div>
                    </div>
                </div>
                授权后表明你已同意 <a href="#">UAP登录服务协议</a>
            </div>
            <div id="msg" class="login-msg"></div>
            <div >
                <input type="button" class="submit" value="登录" onclick="doLogin()">
            </div>
            <input type="hidden" id="client_id" name="client_id" value="${client_id!}" >
            <input type="hidden" id="response_type" name="response_type" value="code" >
            <input type="hidden" id="redirect_uri" name="redirect_uri" value="${redirect_uri!}" >
            <input type="hidden" id="state" name="state" value="${state!}" >
        </form>
        <div id="errMsg"></div>

    </div>
</div>

<script type="text/javascript">
    function doLogin() {
        var username = document.getElementById("userName").value;
        if (null == username || "" == username) {
            $("#msg").html("账号不能为空");
            return false;
        }

        var password = document.getElementById("password").value;
        if (null == password || "" == password) {
            $("#msg").html("密码不能为空");
            return false;
        }
        if(username.length < 2 || username.length > 20){
            $("#msg").html("用户名长度不能小于2位或大于20位");
            return false;
        }
        if(password.length < 6 || password.length > 20){
            $("#msg").html("密码长度不能小于6位或大于20位");
            return false;
        }
        if(!validUserName(username)){
            $("#msg").html("用户名只能包含中文、英文、数字和下划线");
            return false;
        }

        document.getElementById("loginForm").submit();
    }

    /*******************************************************************************
     * 绑定指定表单元素类型的回车事件
     *
     * @param formId
     *            表单
     * @param element
     *            元素类型 (input/select/radio/...)
     * @param subFunction
     *            回车后要执行的js函数
     * @param eventName
     *            键盘事件 (keyup/keydown/keypress...)
     */
    function bindEnter(formId, element, subFunction, eventName) {
        $("#" + formId + " " + element).bind(eventName, function(event) {
            //回车
            if (event.keyCode == '13') {
                subFunction();
            }
        });
    }


    /*******************************************************************************
     * 表单回车事件绑定 表单光标定位
     * @param formId
     * @param subFunction 回车要执行的函数
     */
    function bindFormEvent(formId, subFunction) {
        if (subFunction && subFunction != null) {
            bindEnter(formId, 'input', subFunction, 'keyup');
        }
    }

    function validUserName(value) {
        return /^[a-zA-Z0-9\u4e00-\u9fa5_]+$/.test(value);
    }

    $(function() {
        <% if(has(msg)){%>
            $("#msg").html("${msg}");
        <%}%>
        window.setTimeout(function() {
            $("#userName").focus();
        }, 0);
        bindFormEvent("loginForm", doLogin);
    });
</script>
</body>

</html>